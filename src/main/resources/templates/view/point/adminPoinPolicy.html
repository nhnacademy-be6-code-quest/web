<!DOCTYPE html>
<html lang="ko" th:fragment="adminPointPolicyFragment ('pointPolicy')">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>포인트 정책 관리</title>
  <style>
    /* CSS 스타일을 여기에 추가 */
    .card { width: 100%; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 20px; }
    .card-header { background-color: #f0f0f0; padding: 10px; border-bottom: 1px solid #ccc; }
    .card-title { font-size: 18px; font-weight: bold; }
    .card-description { font-size: 14px; color: #666; }
    .card-content { padding: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; }
    .bg-muted { background-color: #f0f0f0; font-weight: bold; }
    .text-muted-foreground { color: #666; }
    .text-primary { color: #007bff; }
    .text-green-500 { color: #28a745; }
    .text-danger { color: #dc3545; }
    .button { background-color: #007bff; color: #fff; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; display: inline-block; text-decoration: none; }
    .button:hover { background-color: #0056b3; }
    .edit-button { background-color: #ffc107; color: #212529; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; }
    .edit-button:hover { background-color: #e0a800; }
    .activate-button { background-color: #28a745; color: #fff; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; }
    .activate-button:hover { background-color: #218838; }
    .delete-button { background-color: #dc3545; color: #fff; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; }
    .delete-button:hover { background-color: #bd2130; }

    /* 모달 스타일 */
    .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.4); }
    .modal-content { background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 500px; }
    .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
    .close:hover, .close:focus { color: black; text-decoration: none; cursor: pointer; }
  </style>
</head>
<body>
<div class="card">
  <div class="card-header">
    <div class="card-title">포인트 정책 관리</div>
    <div class="card-description">포인트 정책 목록을 확인하고 관리할 수 있습니다.</div>
  </div>
  <div class="card-content">
    <button class="button" onclick="openModal('registerModal')">정책 등록</button>
    <div class="overflow-x-auto">
      <table>
        <thead class="bg-muted">
        <tr>
          <th class="text-muted-foreground">포인트 정책 타입</th>
          <th class="text-muted-foreground">포인트 값</th>
          <th class="text-muted-foreground">정책 시작 시간</th>
          <th class="text-muted-foreground">상태</th>
          <th class="text-muted-foreground">수정</th>
          <th class="text-muted-foreground">활성화</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="point : ${points}">
          <td th:text="${point.pointAccumulationType}"></td>
          <td th:text="${point.pointValue}" class="text-green-500"></td>
          <td th:text="${point.pointPolicyCreationDate}" class="text-muted-foreground"></td>
          <td th:text="${point.pointStatus}" class="text-primary"></td>
          <td>
            <button class="edit-button" th:attr="data-id=${point.pointPolicyId}, data-accumulation-type=${point.pointAccumulationType}, data-value=${point.pointValue}" onclick="openModifyModal(this)">수정</button>
          </td>
          <td>
            <button class="activate-button"
                    th:attr="data-id=${point.pointPolicyId}, data-accumulation-type=${point.pointAccumulationType}"
                    th:if="${point.pointStatus == '비활성화'}"
                    onclick="openActivateModal(this)">
              활성화
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<div class="pagination">
  <div class="pagination-content">
    <!-- 이전 페이지 링크 -->
    <span th:if="${currentPage >=1}">
      <a th:href="@{|/admin/point/policy?page=${currentPage - 1}&size=${pageSize}|}"
         class="pagination-link">&laquo; Previous</a>
    </span>

    <!-- 페이지 번호 링크 -->
    <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}" class="pagination-item">
      <a th:href="@{|/admin/point/policy?page=${i}&size=${pageSize}}"
         th:classappend="${i == currentPage} ? 'pagination-link active' : 'pagination-link'">
        [[${i + 1}]]
      </a>
    </span>

    <!-- 다음 페이지 링크 -->
    <span th:if="${points.hasNext()}">
      <a th:href="@{|/admin/point/policy?page=${currentPage + 1}&size=${pageSize}|}"
         class="pagination-link">Next &raquo;</a>
    </span>
  </div>
</div>
<!-- 등록 모달 -->
<div id="registerModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('registerModal')">&times;</span>
    <form id="policyRegisterForm" th:action="@{/admin/point/policy/register}" method="post">
      <div>
        <label for="pointAccumulationType">포인트 정책 타입:</label>
        <select id="pointAccumulationType" name="pointAccumulationType">
          <option th:each="type : ${pointTypes}" th:value="${type}" th:text="${type}"></option>
        </select>
      </div>
      <div>
        <label for="pointValue">포인트 값:</label>
        <input type="number" id="pointValue" name="pointValue">
      </div>
      <button type="submit">등록</button>
    </form>
  </div>
</div>

<!-- 수정 모달 -->
<div id="modifyModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('modifyModal')">&times;</span>
    <form id="policyModifyForm" th:action="@{/admin/point/policy/modify}" method="post">
      <input type="hidden" id="modifyPointPolicyId"  name="pointPolicyId">
      <input type="hidden" name="_method" value="put">
      <div>
        <label for="modifyPointAccumulationType">포인트 정책 타입:</label>
        <span id="modifyPointAccumulationType" ></span>
      </div>
      <div>
        <label for="modifyPointValue">포인트 값:</label>
        <input type="number" id="modifyPointValue" name="pointValue">
      </div>
      <button type="submit">수정</button>
    </form>
  </div>
</div>

<!-- 활성화 모달 -->
<div id="activateModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('activateModal')">&times;</span>
    <form id="policyActivateForm" th:action="@{/admin/point/policy/active}" method="post">
      <input type="hidden" name="_method" value="put">
      <input type="hidden" id="activatePointPolicyId" name="pointPolicyId">
      <input type="hidden" id="activatePointPolicyType" name="pointAccumulationType">
      <div>
        <p>정책 타입: <span id="activatePointAccumulationType"></span></p>
        <p>이 타입 이름을 활성화하시겠습니까?</p>
      </div>
      <button type="submit">확인</button>
    </form>
  </div>
</div>

<script>
  function openModifyModal(button) {
    const modal = document.getElementById('modifyModal');
    modal.style.display = "block";

    // 버튼에서 data- 속성을 통해 Thymeleaf 변수 값을 가져오기
    const pointPolicyId = button.getAttribute('data-id');
    const pointAccumulationType = button.getAttribute('data-accumulation-type');
    const pointValue = button.getAttribute('data-value');

    // 모달 내의 필드에 Thymeleaf 변수 값을 설정하기
    document.getElementById('modifyPointPolicyId').value = pointPolicyId;
    document.getElementById('modifyPointAccumulationType').textContent = pointAccumulationType;
    document.getElementById('modifyPointValue').value = pointValue;
  }

  function openModal(modalId) {
    document.getElementById(modalId).style.display = "block";
  }

  function closeModal(modalId) {
    document.getElementById(modalId).style.display = "none";
  }
  function openActivateModal(button) {
    const modal = document.getElementById('activateModal');
    modal.style.display = "block";
    const pointPolicyId = button.getAttribute('data-id');
    const pointAccumulationType = button.getAttribute('data-accumulation-type');
    // 활성화 모달 내의 필드에 Thymeleaf 변수 값을 설정하기
    document.getElementById('activatePointPolicyId').value = pointPolicyId;
    document.getElementById('activatePointPolicyType').value = pointAccumulationType;
    document.getElementById('activatePointAccumulationType').textContent = pointAccumulationType;
  }
  window.onclick = function(event) {
    const modals = document.getElementsByClassName("modal");
    for (let i = 0; i < modals.length; i++) {
      if (event.target == modals[i]) {
        closeModal(modals[i].id);

      }
    }
  }

</script>
</body>
</html>
