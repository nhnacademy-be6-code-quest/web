<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <title>결제하기</title>
  <!-- 토스페이먼츠 결제창 SDK 추가 -->
  <script src="https://js.tosspayments.com/v1/payment"></script>
</head>
<body>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // 클라이언트 키로 객체 초기화
    var clientKey = 'test_ck_6bJXmgo28eAm5avd4Pbj8LAnGKWx';
    var tossPayments = TossPayments(clientKey);

    // 결제 정보 가져오기
    var orderTotalAmount = [[${paymentOrderShowRequestDto.getOrderTotalAmount()}]];
    var discountAmountByCoupon = [[${paymentOrderShowRequestDto.getDiscountAmountByCoupon()}]];
    var discountAmountByPoint = [[${paymentOrderShowRequestDto.getDiscountAmountByPoint()}]];
    var amount = orderTotalAmount - discountAmountByCoupon - discountAmountByPoint;

    var orderId = `[[${paymentOrderShowRequestDto.getOrderCode()}]]`;
    var orderName = `[[${paymentOrderShowRequestDto.getOrderHistoryTitle()}]]`;
    var successUrl = `[[${successUrl}]]`;
    var failUrl = `[[${failUrl}]]`;

    // amount가 0이면 successUrl로 리디렉션
    if (amount === 0) {
      window.location.href = successUrl;
    } else {
      // 결제창 띄우기
      tossPayments.requestPayment('카드', {
        amount: amount,
        orderId: orderId,
        orderName: orderName,
        successUrl: successUrl,
        failUrl: failUrl
      })
      .catch(function (error) {
        if (error.code === 'USER_CANCEL') {
          // 결제 고객이 결제창을 닫았을 때 에러 처리
        } else if (error.code === 'INVALID_CARD_COMPANY') {
          // 유효하지 않은 카드 코드에 대한 에러 처리
        }
      });
    }
  });
</script>

</body>
</html>
