<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>결제하기</title>
  <!-- 네이버페이 결제창 SDK 추가 -->
  <script src="https://nsp.pay.naver.com/sdk/js/naverpay.min.js"></script>
</head>
<body>


<script th:inline="javascript">

  var orderCode = /*[[${paymentOrderShowRequestDto.getOrderCode()}]]*/ 'defaultOrderCode';
  var orderTotalAmount = /*[[${paymentOrderShowRequestDto.getOrderTotalAmount()}]]*/ 0;
  var discountAmountByCoupon = /*[[${paymentOrderShowRequestDto.getDiscountAmountByCoupon()}]]*/ 0;
  var discountAmountByPoint = /*[[${paymentOrderShowRequestDto.getDiscountAmountByPoint()}]]*/ 0;
  var successUrl = 'https://localhost:8080/client/order/' + orderCode + '/payment/success?method=naver&amount=' + (orderTotalAmount - discountAmountByCoupon - discountAmountByPoint);

  // 클라이언트 키로 객체 초기화
  var oPay = Naver.Pay.create({
    "mode" : "development", // development or production
    "clientId": "HN3GGCMDdTgGUfl0kFCo", // clientId
    "chainId": "by9qbU1YS0NCZ3l" // chainId
  });

  // 페이지 로드 시 결제 창 띄우기
  window.onload = function() {
    oPay.open({
      productName: `[[${paymentOrderShowRequestDto.getOrderHistoryTitle()}]]`,// 주문번호(주문번호는 상점에서 직접 만들어주세요.)
      merchantPayKey: `[[${paymentOrderShowRequestDto.getOrderCode()}]]`,// 주문번호(주문번호는 상점에서 직접 만들어주세요.)
      totalPayAmount:
          [[${paymentOrderShowRequestDto.getOrderTotalAmount()}]]
          - [[${paymentOrderShowRequestDto.getDiscountAmountByCoupon()}]]
          - [[${paymentOrderShowRequestDto.getDiscountAmountByPoint()}]],
      taxScopeAmount:  [[${paymentOrderShowRequestDto.getOrderTotalAmount()}]]
          - [[${paymentOrderShowRequestDto.getDiscountAmountByCoupon()}]]
          - [[${paymentOrderShowRequestDto.getDiscountAmountByPoint()}]],
      taxExScopeAmount: 0,
      returnUrl: successUrl
    });
  };
  console.log(successUrl);
  // 결제 금액 계산 함수

</script>

</body>
</html>
