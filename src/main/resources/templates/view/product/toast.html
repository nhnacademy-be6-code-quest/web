<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:fragment="bookProductRegisterFragment ()">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.min.css"/>
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <style>
        #container { font-family: arial; font-size: 22px; margin: 25px; display: flex; justify-content: center; align-items: center; }
        #editorContent { height: 50px; }
        img { max-width: 350px; }
    </style>
</head>
<body>
<form action="/test/test" method="post">
    <input type="text" name="productDescription" id="productDescription" placeholder="설명">
    <input type="submit"> 시도
</form>

<div id="content">

</div>
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<script>
    const editor = new toastui.Editor({
        el: document.querySelector('#content'), // 에디터를 적용할 요소 (컨테이너)
        width: '700px',
        height: 'auto',                        // 에디터 영역의 높이 값 (OOOpx || auto)
        initialEditType: 'wysiwyg',            // 최초로 보여줄 에디터 타입 (markdown || wysiwyg)
        initialValue: '내용을 입력해 주세요.',     // 내용의 초기 값으로, 반드시 마크다운 문자열 형태여야 함
        previewStyle: 'tab',                // 마크다운 프리뷰 스타일 (tab || vertical)
        hideModeSwitch: true,  // 모드 전환 버튼 숨기기
        toolbarItems: [
            ['heading', 'bold', 'italic', 'strike'],
            ['hr', 'quote'],
            ['ul', 'ol', 'task', 'indent', 'outdent'],
            ['table', 'image', 'link'],
            ['code', 'codeblock']
        ],
        hooks: {
            async addImageBlobHook(blob, callback) {
                const formData = new FormData();
                formData.append('file', blob);

                try {
                    const response = await fetch('/upload', {
                        method: 'POST',
                        body: formData
                    });
                    if (response.ok) {
                        const imageUrl = await response.text();

                        const width = 300;
                        callback(imageUrl, 'alt text', {
                            width: width
                        });  // 이미지 URL을 에디터에 삽입
                    } else {
                        console.error('Image upload failed:', response.statusText);
                    }
                } catch (error) {
                    console.error('Image upload failed:', error);
                }
            }
        }

    });

    editor.on('change', () => {
        const inputValue = document.getElementById('productDescription');
        inputValue.value = editor.getHTML();
    });
</script>
</body>
</html>