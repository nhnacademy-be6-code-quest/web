<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:fragment="tagFragment">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .admin-tag-add-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 50px;
        }

        .admin-tag-add-btn {
            background-color: #007BFF; /* Blue */
            color: white;
            padding: 8px 16px;
            border: none;
            font-size: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            height: 40px;
            align-content: center;
        }

        .admin-tag-add-btn:hover {
            background-color: #0056b3; /* Darker Blue */
        }
        .tag-form-control {
            color: #908F8D;
            line-height: normal;
            letter-spacing: 0.02125rem;
            text-transform: capitalize;
            margin-top: 20px;
            border-radius: 0;
            border: 0;
            background: #FFF;
            display: flex;
            align-items: center;
            gap: 0.375rem;
            align-self: stretch;
        }
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination a {
            color: #0056b3;
            padding: 8px 16px;
            text-decoration: none;
            transition: background-color .3s;
        }

        .pagination a.active {
            background-color: #0056b3;
            color: white;
            border-radius: 5px;
        }

        .pagination a:hover {
            background-color: #ddd;
            border-radius: 5px;
        }
        .search-form {
            border:0;
        }
    </style>
    <script>
        function openUpdateTagModal(tagName) {
            document.getElementById("currentTagName").value = tagName;
        }

        function saveTag(event) {
            event.preventDefault();

            const tagName = document.getElementById("tagName").value;

            if (confirm('태그를 등록하시겠습니까? \n\n태그명 : ' + tagName)) {
                fetch(`/admin/tags/register?tagName=` + tagName, {
                    method: 'POST'
                })
                    .then(response => {
                        if (response.ok) {
                            alert('성공적으로 등록되었습니다.');
                            location.reload();
                        }else if(response.status === 409){
                            alert('태그명이 중복됩니다.');
                        } else {
                            alert('태그 등록에 실패하였습니다.\n잠시 후 다시 시도해주세요.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while deleting the phone number..');
                    });
            }
        }

        function updateTag(event) {
            event.preventDefault(); // Prevent form submission

            const currentTagName = document.getElementById("currentTagName").value;
            const newTagName = document.getElementById("newTagName").value;

            if (confirm('태그를 수정하시겠습니까? \n\n변경 전 : ' + currentTagName + '\n변경 후 : ' + newTagName)) {
                fetch(`/admin/tags/update?currentTagName=` + currentTagName +'&newTagName=' + newTagName, {
                    method: 'PUT'
                })
                    .then(response => {
                        if (response.ok) {
                            alert('성공적으로 수정되었습니다.');
                            location.reload();
                        }else if(response.status === 409){
                            alert('태그명이 중복됩니다.');
                        } else {
                            alert('태그 수정에 실패하였습니다.\n잠시 후 다시 시도해주세요.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while deleting the phone number..');
                    });
            }
        }
    </script>
</head>
<body>

<main class="main-content flex-grow-1" style="padding-top: 50px; padding-bottom: 50px;">
    <div class="container mx-auto max-w5xl">
        <div class="card shadow-sm">
            <h1 class="text-2xl font-bold"><a href="/admin/tags">Tags</a></h1>
        </div>
        <div class="card-body">
            <div class="mb-4">
                <div class="admin-tag-add-container">
                    <h2 class="text-lg font-semibold" style="display: inline-block">태그</h2>
                    <div class="admin-tag-add-btn" data-bs-toggle="modal" data-bs-target="#addPhoneNumberModal"> 태그 추가 </div>
                </div>
                <div class="pagination">
                    <div class="col-sm-6 offset-sm-2 offset-md-0 col-lg-5 d-none d-lg-block" >
                        <div class="search-bar border rounded-2 px-3 border-dark-subtle">
                            <form id="search-form" class="text-center d-flex align-items-center" action="/admin/tags/containing" method="get">
                                <input type="text" name="tagName" class="form-control border-0 bg-transparent"
                                       placeholder="Search Tag" required/>
                                <button type="submit" class="search-form">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                        <path fill="currentColor"
                                              d="M21.71 20.29L18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 7-7a7 7 0 0 1-7 7Z" />
                                    </svg>
                                </button>
                            </form>
                        </div>
                        <span th:text="'total : ' + ${totalCount}"></span>
                    </div>
                </div>
                <div th:unless="${empty}" class="pagination">
                    <a th:class="'active'" th:href="${url}+ '&sort=tagId'">등록순</a>
                    <a th:class="'active'" th:href="${url}+ '&sort=tagName'">이름순(역순)</a>
                    <a th:class="'active'" th:href="${url}+ '&sort=tagName&desc=false'">이름순</a>
                </div>

                <div class="pagination" th:each="tag : ${tagPage}">
                    <label></label>
                    <textarea class="tag-form-control" th:text="${tag.tagName}" style="resize: none; width: 600px" readonly></textarea>
                    <div class="admin-tag-add-btn" th:tagName="${tag.tagName}" onclick="openUpdateTagModal(this.getAttribute('tagName'))" data-bs-toggle="modal" th:on data-bs-target="#updateTagModal"> 수정</div>
                </div>
            </div>
        </div>
    </div>
    <div th:unless="${empty}" class="pagination" th:attr="data-total-pages=${totalPage},data-current-page=${page}">
                <span th:if="${page > 1}">
                    <a th:href="${url} + 'page=' + ${page - 1} + ${sort == null ? '' : '&sort=' + sort} + ${desc == null ? '' : '&desc=' + desc}">Previous</a>
                </span>
        <span th:each="pageNum : ${#numbers.sequence(1, totalPage)}">
                    <a th:if="${pageNum == page}" th:text="${pageNum}" th:class="'active'"></a>
                    <a th:if="${pageNum != page}" th:href="${url} + 'page=' + ${pageNum} + ${sort == null ? '' : '&sort=' + sort} + ${desc == null ? '' : '&desc=' + desc}" th:text="${pageNum}"></a>
                </span>
        <span th:if="${page < totalPage}">
                    <a th:href="${url} + 'page=' + ${page + 1}+ ${sort == null ? '' : '&sort=' + sort} + ${desc == null ? '' : '&desc=' + desc}">Next</a>
                </span>
    </div>
    <div th:if="${empty}">
        <div class="mb-4 text-center border" >
            <h3>검색 결과가 없습니다.</h3>
        </div>
    </div>
</main>

</body>

<div class="modal fade" id="addPhoneNumberModal" tabindex="-1" aria-labelledby="addPhoneNumberModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addAddressModalLabel">Save new Tag</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form onsubmit="saveTag(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label>태그명</label>
                        <input type="text" class="form-control" name="tagName" id="tagName"  required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="updateTagModal" tabindex="-1" aria-labelledby="updateTagLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateTagLabel">Update Tag</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form onsubmit="updateTag(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label>기존 태그명</label>
                        <input type="text" class="form-control" name="currentTagName" id="currentTagName"  readonly />
                        <label>새로운 태그명</label>
                        <input type="text" class="form-control" name="newTagName" id="newTagName" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>
</div>
</html>